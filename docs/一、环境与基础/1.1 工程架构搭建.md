# 1.1 å·¥ç¨‹æ¶æ„æ­å»º

vue3æºç é‡‡ç”¨**ç°ä»£Monorepo ç®¡ç†** [vuejs/core: ğŸ–– Vue.js is a progressive, incrementally-adoptable JavaScript framework for building UI on the web.](https://github.com/vuejs/core)  å› æ­¤**æœ€å¥½çš„å‚è€ƒå¯¹è±¡å°±æ˜¯ Vue 3 æºç æœ¬èº«çš„æ¶æ„monorepo**

**monorepoçš„å¥½å¤„ï¼šåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæ˜¯å­˜åœ¨ä¸€ä¸ªä¸€ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯å„åŠŸèƒ½æ¨¡å—è¿›è¡Œå¼€å‘æ‰“åŒ…å¼•ç”¨ï¼Œè€Œä¸€æ—¦æŸä¸ªæ¨¡å—å‡ºç°é—®é¢˜éœ€è¦é‡æ–°æ‰“åŒ…å¼•ç”¨ã€‚è€Œmonorepoå¯ä»¥ç»Ÿä¸€å‘å¸ƒã€ç»Ÿä¸€è§„èŒƒã€‚**

å¸¸è§„ monorepo ç»“æ„ç¤ºä¾‹ï¼š

```bash
my-monorepo/
â”œâ”€â”€ package.json           # æ ¹ç›®å½•
â”œâ”€â”€ pnpm-workspace.yaml    # å·¥ä½œåŒºé…ç½®æ–‡ä»¶
â”œâ”€â”€ packages/ # å„ç§åŒ…
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ package.json
```

## ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ– Monorepo - å·¥ä½œåŒº

- åˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ–ï¼š

```bash
mkdir mini-vue
pnpm init #åˆå§‹åŒ–é¡¹ç›®
```

- **åˆ›å»º `pnpm-workspace.yaml`ï¼š**åœ¨æ ¹ç›®å½•åˆ›å»ºæ­¤æ–‡ä»¶ï¼Œ æ ‡è®°æºç éƒ¨åˆ†ï¼ŒåŒæ—¶åŒæ­¥æ–°å»ºä¸€ä¸ª**packages**æ–‡ä»¶å¤¹ç”¨äºæˆ‘ä»¬é¦–å…ˆæˆ‘ä»¬çš„vueä»£ç 

```bash
packages:
  - 'packages/*'
```

## ç¬¬äºŒæ­¥ï¼šé…ç½® TypeScript (å…¨å±€æ§åˆ¶)

éœ€è¦åœ¨**æ ¹ç›®å½•é…ç½® TS**ï¼Œè®©æ‰€æœ‰å­åŒ…å…±äº«é…ç½®

- **å®‰è£…ä¾èµ–ï¼š**å®‰è£… TS æœ¬èº«ä»¥åŠ Node çš„ç±»å‹å®šä¹‰

```bash
# -w è¡¨ç¤ºå®‰è£…åˆ°æ ¹ç›®å½• workspace root å·¥ä½œåŒºæ ¹ç›®å½•çš„ package.json ä¸­æ·»åŠ ä¾èµ–
pnpm add typescript @types/node -D -w 
```

- åˆå§‹åŒ– `tsconfig.json`

```bash
npx tsc --init
```

- ä¿®æ”¹ `tsconfig.json` (å…³é”®é…ç½®) ï¼š ä¸»è¦é…ç½®è·¯å¾„æ˜ å°„ (Path Alias)

```bash
{
  "compilerOptions": {
    "baseUrl": ".", # ç½®è§£æéç›¸å¯¹è·¯å¾„æ¨¡å—çš„â€œåŸºå‡†ç›®å½•â€ã€‚
    "paths": { 
	    # é…ç½®è·¯å¾„æ˜ å°„ æœåŠ¡äºç¼–è¾‘é˜¶æ®µï¼Œå®ƒæ˜¯å‘Šè¯‰TypeScriptç¼–è¯‘å™¨
	    # å»å“ªé‡Œæ‰¾æ–‡ä»¶ - ä»…æ˜¯ç”¨äºâ€œç±»å‹æ£€æŸ¥â€å’Œâ€œç¼–è¾‘å™¨è¯†åˆ«â€
	    # ä¸ä¼šæ”¹å˜ç¼–è¯‘å‡ºæ¥çš„ JavaScript ä»£ç ä¸­çš„å¼•ç”¨è·¯å¾„ - åé¢è¿˜éœ€è¦**æ„å»ºå·¥å…·**å‡ºåœº
      "@mini-vue/*": ["packages/*/src"]
    },
    "target": "esnext", # æŒ‡å®šç¼–è¯‘å‡ºçš„ JavaScript ä»£ç çš„ ECM ç‰ˆæœ¬
    "module": "esnext",  # ä¿ç•™ import å’Œ export è¯­å¥ï¼Œæ‰“åŒ…å·¥å…·æœªæ¥æ‰å¯ä»¥è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–
    "moduleResolution": "node", # å†³å®š TS å¦‚ä½•å¤„ç†æ¨¡å—å¯¼å…¥ï¼ˆæ¯”å¦‚ import { x } from 'vue'ï¼‰
    "strict": true,  
    "sourceMap": true, # ç”Ÿæˆ .map æ–‡ä»¶è°ƒè¯•ï¼Œåœ¨æµè§ˆå™¨æ‰“æ–­ç‚¹æ—¶ï¼Œçœ‹åˆ°çš„ä¾ç„¶æ˜¯.ts æºç 
    "resolveJsonModule": true, #TS ä¼šè‡ªåŠ¨æŠŠ JSON æ–‡ä»¶çš„å†…å®¹æ¨æ–­ä¸ºå¯¹è±¡ç±»å‹
    "esModuleInterop": true, # å…è®¸æ›´é¡ºæ»‘åœ°å¯¼å…¥ CommonJS æ¨¡å—
    "lib": ["esnext", "dom"] # ç¯å¢ƒæ„ŸçŸ¥ å‘Šè¯‰ TS ç¼–è¯‘å™¨ï¼Œä»£ç è¿è¡Œç¯å¢ƒé‡Œæœ‰å“ªäº›å†…ç½®å¯¹è±¡
  }
}

```

## ç¬¬ä¸‰æ­¥ï¼šé…ç½® Vitest (æµ‹è¯•é©±åŠ¨å¼€å‘)

ç”±äºæˆ‘ä»¬åŸºæœ¬ä¸Šæ²¡æœ‰é¡µé¢é€»è¾‘æµ‹è¯•ï¼Œå› æ­¤æœ€å¥½çš„æ–¹å¼å°±æ˜¯TDD(æµ‹è¯•é©±åŠ¨å¼€å‘)

- å®‰è£… Vitestï¼š

```bash
pnpm add vitest -D -w
```

- åˆ›å»º **vitest.config.ts**

```bash
import { defineConfig } from 'vitest/config'
import path from 'path'

export default defineConfig({
  test: {
    globals: true, // å¼€å¯ describe, it, expect å…¨å±€å˜é‡
  },
  resolve: {
    alias: [
      {
        find: /@mini-vue\/(\w+)/,
        replacement: path.resolve(__dirname, 'packages/$1/src')
      }
    ]
  }
})
```

---