# 3.2.1 runtime-core 流程概览 & `createApp` 入口

## Runtime-Core 流程概览

在 Vue 3 的设计中，`runtime-core` 是一个**平台无关**（不包含任何 DOM 操作，**能运行在浏览器、Canvas 或 iOS (Weex/UniApp) 上，它需要外部传入节点操作方法**）的运行时。`runtime-core`只负责“什么时候更新”、“怎么对比新旧节点(Diff)”、“组件生命周期”等纯逻辑。

因此，它的架构流程如下：

1. **定义接口 (`createAppAPI`)**：
`runtime-core` 导出一个 `createAppAPI` 函数。这个函数**并不直接**被用户调用，而是等待被渲染器 `Renderer`调用。
2. **注入依赖 (`render`)**：
外部（渲染器）调用 `createAppAPI` 时，必须传给它一个 `render` （Renerer内部的一个**具体函数-启动渲染器**）函数。`createApp` 就拥有了渲染能力。
3. **用户调用**：
用户拿到的是已经注入了 `render` 逻辑的 `createApp`，调用 `mount` 时，内部直接执行注入的 `render`

## 3.2.2 createApp

runtime-core 入口文件，**产生createApp工厂函数的工厂**

```typescript
//packages/runtime-core/src/apiCreateApp.ts
/**
 * createAppAPI:
 * 产生createApp工厂函数的工厂（高阶函数）。
 * 它的作用是接收 render 函数，然后返回真正的 createApp 函数。
 * * @param render - 由 Renderer 传入的具体渲染函数
 */
export function createAppAPI(
    render
) {
    return function createApp(rootComponent) {
        return {
            // 核心挂载方法 rootContainer 挂载的DOM对象
            mount(rootContainer) {
                // 1. rootComponent 转换为虚拟节点
                // 伪代码
                const vnode = {
                    type: rootComponent
                };
                // 2. 触发渲染核心，将vnode + rootContainer构成
                // vnode树，然后转换为真实DOM，显示在页面上
                render(vnode, rootContainer)
            }
        }
    }
}
```
